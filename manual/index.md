最終更新日：2025/05/22

この度はカルステップをご購入いただき誠にありがとうございます！
以下に、カルステップの初期設定方法をご紹介いたします。
ご不明な点がございましたら、担当者 丸山（ [drkurukuru@gmail.com](mailto:drkurukuru@gmail.com) ） までいつでもご相談ください。

# googleスプレッドシートの共有
解説動画： [https://youtu.be/VYT80F02riw](https://youtu.be/VYT80F02riw)

1. 運営（ drkurukuru@gmail.com ）にクリニックで使用されるGoogleアカウント（gmailなど）をお知らせください。
2. 運営より、あなた専用のGoogleスプレッドシートの共有連絡がメールで届きます。
3. 続いて、「スプレッドシートのオーナーとして招待されました」というメールが届くので、「承諾」してください。
上記の作業により、スプレッドシートの所有権があなたに移譲されます。運営は共有メンバーから抜けるので、このスプレッドシートはあなたのアカウントしか閲覧・編集できない状態となります。
個人情報保護のため、ご使用になるGoogleアカウントは必ず２段階認証を採用してください。

# ライセンス認証
解説動画：[https://youtu.be/mWNne-xiKKE](https://youtu.be/mWNne-xiKKE)

ダウンロードサイト： [https://mjs-com.github.io/karustep-download-site/](https://mjs-com.github.io/karustep-download-site/)

1. 上記URLから最新版のzipファイルをダウンロードしてください。
2. zipファイルを解凍し、「カルステップ.bat」をダブルクリックするとアプリが起動します。
3. 初回は端末番号（HDIW）の書かれた画面が出てくるので、「メールを送信」ボタンをクリックします。
 ![ライセンス認証画面](images/2025-05-18_120247.png)
4. メールに「クリニック名」と「購入時の使用したお名前」を追加で記載し、メールを送信してください。
5. 運営よりライセンス登録完了のメールが届いたら完了です。

# Azureアカウント開設と委任の設定
## Azureアカウント開設
解説動画： [https://youtu.be/2_lAmjdG-D8](https://youtu.be/2_lAmjdG-D8)

1.  Googleなどの検索エンジンで「Azure」と検索し、「Microsoft Azure」の公式サイトをクリックしてください。
2.  Azureのページが表示されたら、「Azure を無料でお試しください」をクリックします。
3.  「アカウントをお持ちでない場合、作成できます」の下線が引いてある「作成」リンクをクリックしてください。
4.  登録に使用するメールアドレスを入力します。
5.  入力したメールアドレスに届いたセキュリティコード（確認コード）を入力します。
6.  画面の指示に従い、生年月日などの必要情報を入力します。
7.  電話番号を入力し、SMSなどで受信した確認コードを入力して認証を行ってください。
8.  利用規約等への同意にチェックを入れ、「次へ」をクリックします。
9. クレジットカードの情報を入力します。（最初の30日間は200ドル相当の無料クレジットが利用可能です。）
10. アカウントの保護に関する設定画面が表示された場合は、画面の指示に従い「次へ」をクリックして進めてください。
11. アグリーメント（契約条件）を確認し、同意のチェックを入れて次に進みます。
12. テクニカルサポートのプラン選択画面が表示された場合、「サポートに加入しない」を選んでください。
上記の手順が完了すると、Azureアカウントの登録は終了です。これで、Azureの各種サービスが利用可能な状態になります。

## 2段階認証の設定
解説動画： [https://youtu.be/2qsM79MaTkQ](https://youtu.be/2qsM79MaTkQ)

Azureアカウントのセキュリティを強化するため、2段階認証の設定を強く推奨いたします。

1.  Azureポータルの右上に表示されているご自身のアカウントアイコンをクリックし、「Microsoft アカウント」を選択してください。
2.  表示されたアカウント管理ページの左側にあるタブから「セキュリティ」を選択します。
3.  セキュリティのオプションが表示されますので、「サインイン方法の管理」をクリックしてください。
4.  2段階認証の項目を見つけ、「オンにする」をクリックします。
    * まだアカウントのパスワードを設定していない場合は、このタイミングでパスワードの設定を求められることがあります。画面の指示に従ってパスワードを設定してください。
5.  追加認証の方法を選択する画面が表示されます。セキュリティの観点から、認証アプリ（例：Microsoft Authenticator）のご利用をお勧めします。
    - 認証の手段が「アプリ」になっている状態で「今すぐ取得」ボタンをクリックします。
    - 携帯電話（スマートフォン）で認証アプリを準備します。Microsoft Authenticatorアプリ（鍵の中に人が描かれたようなアイコンが目印です）をダウンロードし、インストールしてください。
    - アプリの準備が整ったら、パソコンの画面で「次へ」をクリックします。
    - パソコンの画面にQRコードが表示されます。携帯電話にインストールしたMicrosoft Authenticatorアプリを起動し、画面の指示に従ってこのQRコードをスキャンしてください。（右下にQRコードアイコンがあるのでそれをタップします。）
    - QRコードの読み取りが成功し、アプリとの連携が完了すると、認証アプリによる2段階認証の基本的なセットアップは完了です。
すべての設定が完了したら、再度セキュリティの画面に戻り、2段階認証が「オン」になっていることをご確認ください。
    * **注記：** 設定直後に2段階認証が「オフ」と表示されている場合があります。その際は、一度ページを更新するか、再度2段階認証の管理画面に入り直して設定状況を確認してください。正しく設定が完了していれば、「2段階認証が承認されました」といった趣旨のメッセージが表示されるか、ステータスが「オン」に変わります。
以上で、2段階認証の設定は完了です。これにより、アカウントのセキュリティが向上します。

## Azureの委任手続き
解説動画： [https://youtu.be/FyNI4saCLik](https://youtu.be/FyNI4saCLik)

カルステップでは、Azureサービスによる文字起こしや生成AIの機能を利用します。これらの詳細な設定作業をカルステップ運営にお任せいただくための委任設定についてご説明します。

1.  **サブスクリプション名の変更**
    1.  Azureポータルの検索バーに「サブスク」と入力し、表示された「サブスクリプション」を選択してください。
    2.  リストに表示されている「Azure サブスクリプション 1」（または類似の名称のサブスクリプション）をクリックします。
    3.  サブスクリプションの詳細画面で、「名前の変更」をクリックしてください。
    4.  表示された入力欄に、あなたの「クリニック名」を入力し、「保存」をクリックします。
        * **変更理由：** カルステップ運営側では複数のアカウントを管理しております。誤操作を防ぎ、お客様のアカウントを明確に識別するために、分かりやすい名称に変更をお願いいたします。

2.  **Azure Lighthouseの設定**
    1.  Azureポータルの検索バーに英語で「Lighthouse」と入力し、表示された灯台マークの「Azure Lighthouse」を選択してください。
    2.  Azure Lighthouseの画面が表示されたら、右側にある「サービスプロバイダーのオファーの表示」を選択し、続いて、画面中央の「サービスプロバイダーのオファーの表示」ボタンをクリックしてください。
    3.  画面左上にある「オファーの追加」をクリックし、ドロップダウンメニューから「テンプレート経由で追加」を選択してください。
    4.  「テンプレートをアップロード」の画面が表示されます。あらかじめダウンロードしていただいたカルステップのフォルダ内にある「**Karustep_Azure_Lighthouse.json**」というファイルを、点線の枠内にドラッグ＆ドロップしてください。
    5.  ファイルが選択されたことを確認し、「アップロード」ボタンをクリックします。
    6.  「カスタムデプロイ」というページに移動します。以下の項目を設定してください。
        * **サブスクリプション：** 先ほど名前を変更したサブスクリプション（例：ご自身のクリニック名）を選択してください。
            * **注記：** サブスクリプション名の変更が反映されるまで10分以上かかる場合があります。変更直後で新しい名前が表示されない場合は、元の「Azure サブスクリプション 1」などの名称を選択して進めていただいて問題ありません。
        * **リージョン：** 「**(Asia Pacific) Japan East**」（東日本）を選択してください。
        * 下部にある「Msp Offer Name」と「Msp Offer Description」の項目は、アップロードしたテンプレートファイルの内容が自動的に反映されるため、変更の必要はありません。
    7.  入力内容を確認し、「確認と作成」ボタンをクリックしてください。
    8.  検証が成功すると、画面下部に青色の「作成」ボタンが表示されますので、クリックしてください。（一時的に白い画面になることがありますが、エラーではありませんのでしばらくお待ちください。）
    9.  「デプロイが完了しました」というメッセージが表示されたら、この作業は完了です。

3.  **委任の確認**
    1.  再度Azureポータルの検索バーから「Azure Lighthouse」を検索し、選択します。
    2.  右側の「サービスプロバイダーのオファーの表示」を選択し、次に右側にある「委任の表示」ボタンをクリックしてください。
    3.  表示されたリストの上部にある「最新の情報に更新」ボタンをクリックします。
    4.  以下の情報が表示されていれば、委任は正しく完了しています。
        * **サブスクリプション名：** ご自身で設定したクリニック名（または元のサブスクリプション名）
        * **オファー名：** Karustep_Lighthouse_Template（または類似の名称）
        * **サービスプロバイダー：** 合同会社MJSカンパニー
        * **ロールの割り当て：** 「削除ロール」と「共同作成者」

お疲れ様でした。これでAzureの委任手続きは完了です。
最後に、カルステップ運営サイドでは委任された通知が来ないため、お委任手続きが完了したことをカルステップ運営（[drkurukuru@gmail.com](mailto:drkurukuru@gmail.com) ） までご連絡ください。

ご連絡をいただき次第、API-keyを発行させていただきます。お手数をおかけしますが、どうぞよろしくお願い致します。

## カルステップへのAPI-keyなどの登録
解説動画： [https://youtu.be/oCLn4hZQPRw](https://youtu.be/oCLn4hZQPRw)

Azureの委任手続きが完了したことをカルステップ運営が確認次第、文字起こしや要約に使用するAPI-keyを発行いたします。発行されたAPI-keyなど、カルステップに登録が必要な情報は、まとめてHTML形式の添付ファイルとしてメールでお送りします。

1.  **運営からの情報受領**
    1.  カルステップ運営より、設定情報が記載されたHTMLファイルが添付されたメールが届きます。
    2.  HTMLファイルを開くためのパスワードが記載された、別のメールも届きます。必ず両方のメールをご確認ください。

2.  **設定情報の確認**
    1.  添付されているHTMLファイルをPCに保存するか、直接開いてください。
        * HTMLファイルを開くと、Google Chromeなどのブラウザで表示されますが、これはPC内のファイルを開いている状態であり、インターネットには接続されていません。
    2.  ファイルを開くとパスワードの入力が求められます。別途送られてきたメールに記載されているパスワードをコピー＆ペーストし、「認証して開く」をクリックしてください。
    3.  認証に成功すると、以下の4つの情報が表示されます。
        * Azure Speech Key
        * Azure OpenAI API Key
        * Azure OpenAI Endpoint
        * Google Spreadsheet ID

3.  **カルステップアプリへの登録**
    1.  カルステップのアプリケーションを起動してください。
    2.  画面上部の「設定」タブをクリックし、次に「APIキーの登録」を選択してください。
    3.  表示された設定画面の各項目に、先ほどHTMLファイルで確認した情報を以下のように入力（コピー＆ペースト）します。HTMLファイル内の項目の右側にあるコピーボタンをクリックし、各項目の欄に貼り付けます。
    4.  「Deployment Name」「API Version」「Google Sheet Name」といった項目は、あらかじめ入力されていますので、そのまま変更せずにご使用ください。
    5.  すべての情報の入力が完了したら、画面下部にある「保存」ボタンをクリックしてください。

以上で、カルステップへのAPIキーなどの登録は完了です。これでカルステップの全機能がご利用いただけるようになります。設定お疲れ様でした！

# カルステップの使用方法
カルステップ実演動画（short version）： [https://youtu.be/XBsISBwFxck](https://youtu.be/XBsISBwFxck)

カルステップ実演動画（詳細説明）： [https://youtu.be/axApARZNZN0](https://youtu.be/axApARZNZN0)

カルステップの基本的な使用方法についてご説明します。
### 1. カルステップの起動
1.  カルステップが保存されているフォルダを開き、「カルステップ.bat」をダブルクリックしてアプリケーションを起動します。
2.  ライセンス認証が正常に完了していれば、カルステップのメイン操作画面が表示されます。

### 2. 基本的な録音操作（画面上のボタンを使用）
カルステップのメイン画面には、録音をコントロールするための主要なボタンが配置されています。
1.  **録音開始**: 診療の記録を開始する際は、「スタート」ボタンをクリックしてください。
2.  **録音終了**: 記録を終了する場合は、「ストップ」ボタンをクリックします。この操作により、録音された音声の文字起こし、AIによる要約、およびデータの保存が自動的に実行されます。
3.  **一時停止**: 録音を一時的に中断したい場合は、「一時停止」ボタンをクリックします。例えば、患者さんが一時的に席を外す場合などに使用します。
4.  **録音再開**: 一時停止した録音を同じ記録として再開する場合は、「リスタート」ボタンをクリックしてください。

録音中はタスクバーのアイコンが下図のように、赤いアイコンに変化し点滅するため、一目で状態が分かります。
![録音状態のタスクバー](images/2025-05-22_171158.png)

### 3. フットスイッチを使用した録音操作
お渡ししているフットスイッチを使用することで、より迅速かつハンズフリーで録音操作が可能です。この機能は、カルステップの画面が最前面に表示されていない状態（例：電子カルテを操作中など）でも利用できます。
1.  **録音開始**: フットスイッチを一度踏むと、録音が開始されます。
2.  **録音終了**: 録音中に再度フットスイッチを踏むと、録音が終了します。その後、自動的に文字起こし、要約処理、データ保存が行われます。

もしゲーミングマウスの副ボタンやStream Deckを用いて、カルステップをご利用される場合は「Ctrl + Shift + ,(カンマ)」を割り当ててください。

### 4. 記録内容の確認方法
要約内容は、いつでも簡単に確認することができます。
1.  カルステップのメイン画面にある「要約を見る」ボタンをクリックしてください。
2.  過去の記録データの一覧が表示され、任意の記録を閲覧できます。

音声ファイルや全文文字起こしの文章は「tempフォルダ（"C:\temp"）」に保存されます。ファイル名は録音時のタイムスタンプ（日付と時刻）となっています。
![録音ファイルの保存場所](images/2025-05-19_002750.png)

### 5. 出力形式とシステムプロンプトについて
カルステップは、AIへの指示（システムプロンプト）を調整することで、出力される情報の形式や詳細度をコントロールする機能を有しています。
* **診療科や状況に応じた設定例**:
    * **デフォルト**: 例えば、保護者とお子様が一緒に診察を受ける場合など、複数の話者が存在する状況にも対応しやすく、汎用的な内容で出力されるように調整されています。
    * **内科（1対1）**: 医師と患者様の1対1の対話を主眼とし、AIが話者を誤認識しにくいように最適化されたプロンプトが設定されています。
    * **会話ログ形式**: 参加者の発言が時系列に沿って記録される形式です。

これらのシステムプロンプトは、「診療科選択」のタブから切り替えることが可能です。詳細な編集方法については、「カルステップのシステムプロンプトと補正辞書の編集方法」の項目をご参照ください。

# カルステップのシステムプロンプトと補正辞書の編集方法
解説動画： [https://youtu.be/9_5bIymDD3Q](https://youtu.be/9_5bIymDD3Q)

カルステップでは、AIによる文字起こしや要約の精度、さらには出力される情報の形式を、診療科や状況に合わせてより最適化するために、システムプロンプトと補正辞書を編集する機能を提供しています。

### 1. システムプロンプトの選択と編集
システムプロンプトは、AIに対してどのような役割を期待し、どのような情報に基づいて、どのような形式でアウトプットを生成してほしいかを指示するための設定群です。

#### a. システムプロンプトの選択
1.  カルステップアプリの画面右上にある「診療科選択」タブをクリックしてください。
2.  あらかじめ登録されているシステムプロンプトの一覧（例：「デフォルト（同時複数患者可）」「内科（１対１）」「会話ログあり」など）が表示されます。利用するシーンや目的に最も適したものを選択してください。

また、システムプロンプトは追加可能です。カルステップのフォルダの中にある「programs」フォルダに入ると、システムプロンプトがあります。このうちのどれかを複製すれば、システムプロンプトを増やせます。ファイル名は必ず「2桁の数字＋名前」にしてください。例えば「02.耳鼻科オリジナル.txt」といった形でファイル名を設定してください。
![システムプロンプトの保存場所](images/2025-05-22_120448.png)

#### b. システムプロンプトの編集
現在選択しているシステムプロンプトの内容をカスタマイズしたり、必要に応じて新たなシステムプロンプトを作成したりすることが可能です。

1.  アプリ画面上部の「設定」タブよりシステムプロンプトの編集画面を開きます。
2.  編集画面では、主に以下のような項目について、AIへの指示を具体的に記述・編集することができます。
    * **入力フォーマット**: AIにどのような内容を覚えておいてほしいか指定できます。
    * **出力項目と内容の指示**: Googleスプレッドシートの各セル（「fact」「assessment」「ToDo」）に、どのような情報を、どのような形式や粒度で記述してほしいかを詳細に指示します。
        * **具体例**: 「会話ログあり」のプロンプトの場合、「To-Doセクション」に「発話された内容を可能な限り忠実に転記すること」といった指示を含めることで、会話の逐語記録に近い出力を得ることができます。
3.  編集が完了したら、必ず「保存」ボタンをクリックして、変更内容をシステムプロンプトに適用してください。

### 2. 補正辞書の編集
補正辞書に特定の単語やフレーズを登録しておくことで、専門用語、略語、固有名称（医薬品名、施設名、地域名など）、あるいは特有の言い回しについて、AIがより正確に認識し、意図した通りの正しい表記で出力するよう促すことができます。

1.  カルステップアプリ内の「設定」タブから「補正辞書の編集」画面を開いてください。
2.  以下の形式に従って、AIに正しく認識・変換させたい言葉と、それに対応する正しい表記を一行ずつ登録します。
    * **登録形式**: `AIに認識させたい言葉（ひらがなでの入力推奨、またはAIが誤認識しやすい実際の入力例）` → `AIに出力させたい正しい表記（漢字、カタカナ、正式名称など）`
    * **登録例**:
        * `じびいんこうか` → `耳鼻咽喉科`
        * `かるなーる` → `カロナール`
        * `あいしーゆー` → `ICU（集中治療室）`
        * `ぷろびーえぬぴー` → `proBNP（心不全参考値）`
3.  必要な単語の登録や編集が完了したら、「保存」ボタンをクリックしてください。

## カルステップの月額利用料について（Azure利用料の確認方法）
解説動画： [https://youtu.be/2DVJKqh7aqU](https://youtu.be/2DVJKqh7aqU)

カルステップで利用するAzureサービスの月額利用料（ランニングコスト）をご自身で把握する方法についてご説明します。

1.  **サブスクリプションの選択**
    1.  Azureポータルにサインインします。
    2.  画面上部の検索バーに「サブスクリプション」と入力し、表示された「サブスクリプション」サービスをクリックしてください。
    3.  サブスクリプションの一覧が表示されます。通常、お客様がご利用のサブスクリプションは1つですので、該当のサブスクリプション名（例：ご自身のクリニック名、または「Azure サブスクリプション 1」など）をクリックしてください。

2.  **コスト分析の表示**
    1.  サブスクリプションの詳細画面が開きます。左側のメニューから「コスト管理」の項目の中にある「コスト分析」をクリックしてください。

3.  **コストの確認**
    1.  コスト分析の画面が表示され、利用状況に応じたグラフなどが表示されます。
        * **現在のコストと予測：** グラフには、特定の日付までに実際に使用されたコストと、現時点までの総コストが表示されます。また、薄緑色などで当月の予測コストが示されることもあります。
        * **期間の指定：** 画面上部の日付範囲フィルター（例：「過去 7 日間」「今月」など）で、表示する期間を変更できます。
        * **グラフの詳細：**
            * 「細分性」を「日単位」などに変更すると、日ごとの利用料をグラフで確認できます。
            * 円グラフ表示を見ることで、サービスごとのコスト割合などを確認することも可能です。
        * **グループ化（参考）：** 「グループ化」オプションで「リソースグループ名」などを選択すると、リソースグループごとのコスト内訳が表示されますが、通常、お客様は単一のクリニックでご利用いただくため、複雑な色分け表示にはならない想定です。
    2.  この画面で「実際の費用」や「予測される今月の費用」を確認することで、Azureサービスのランニングコストを把握できます。

ご自身の利用状況を確認し、安心してサービスをご利用いただくための参考となれば幸いです。