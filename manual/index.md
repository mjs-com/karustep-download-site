この度はカルステップをご購入いただき誠にありがとうございます！
以下に、カルステップの初期設定方法をご紹介いたします。
ご不明な点がございましたら、担当者 丸山（ [drkurukuru@gmail.com](mailto:drkurukuru@gmail.com) ） までいつでもご相談ください。

# googleスプレッドシートの共有
解説動画： [https://youtu.be/VYT80F02riw](https://youtu.be/VYT80F02riw)

1. 運営（ drkurukuru@gmail.com ）にクリニックで使用されるGoogleアカウント（gmailなど）をお知らせください。
2. 運営より、あなた専用のGoogleスプレッドシートの共有連絡がメールで届きます。
3. 続いて、「スプレッドシートのオーナーとして招待されました」というメールが届くので、「承諾」してください。
上記の作業により、スプレッドシートの所有権があなたに移譲されます。運営は共有メンバーから抜けるので、このスプレッドシートはあなたのアカウントしか閲覧・編集できない状態となります。
個人情報保護のため、ご使用になるGoogleアカウントは必ず２段階認証を採用してください。

# ライセンス認証
解説動画：[https://youtu.be/wvhne6F1QDA](https://youtu.be/wvhne6F1QDA)

ダウンロードサイト： [https://mjs-com.github.io/karustep-download-site/](https://mjs-com.github.io/karustep-download-site/)

1. 上記URLから最新版のzipファイルをダウンロードしてください。
2. zipファイルを解凍し、「カルステップ.bat」をダブルクリックするとアプリが起動します。
3. 初回は端末番号（HDIW）の書かれた画面が出てくるので、「メールを送信」ボタンをクリックします。
 ![ライセンス認証画面](images/2025-05-18_120247.png)
4. メールに「クリニック名」と「購入時の使用したお名前」を追加で記載し、メールを送信してください。
5. 運営よりライセンス登録完了のメールが届きます。メールに含まれる「Google Spreadsheet ID」を保管（メモ）してください。
6. 再度「カルステップ.bat」をダブルクリックして起動してください。
7. 「設定タブ」→「API-keyの登録」をクリックし、「Google Spreadsheet ID」のテキストボックスに、保管（メモ）したIDを記載し保存してください。

# Azureアカウント開設とAPI-keyの設定
## Azureアカウント開設
解説動画： [https://youtu.be/2_lAmjdG-D8](https://youtu.be/2_lAmjdG-D8)

1.  Googleなどの検索エンジンで「Azure」と検索し、「Microsoft Azure」の公式サイトをクリックしてください。
2.  Azureのページが表示されたら、「Azure を無料でお試しください」をクリックします。
3.  「アカウントをお持ちでない場合、作成できます」の下線が引いてある「作成」リンクをクリックしてください。
4.  登録に使用するメールアドレスを入力します。
5.  入力したメールアドレスに届いたセキュリティコード（確認コード）を入力します。
6.  画面の指示に従い、生年月日などの必要情報を入力します。
7.  電話番号を入力し、SMSなどで受信した確認コードを入力して認証を行ってください。
8.  利用規約等への同意にチェックを入れ、「次へ」をクリックします。
9. クレジットカードの情報を入力します。（最初の30日間は200ドル相当の無料クレジットが利用可能です。）
10. アカウントの保護に関する設定画面が表示された場合は、画面の指示に従い「次へ」をクリックして進めてください。
11. アグリーメント（契約条件）を確認し、同意のチェックを入れて次に進みます。
12. テクニカルサポートのプラン選択画面が表示された場合、「サポートに加入しない」を選んでください。
上記の手順が完了すると、Azureアカウントの登録は終了です。これで、Azureの各種サービスが利用可能な状態になります。

## 2段階認証の設定
解説動画： [https://youtu.be/2qsM79MaTkQ](https://youtu.be/2qsM79MaTkQ)

Azureアカウントのセキュリティを強化するため、2段階認証の設定を強く推奨いたします。

1.  Azureポータルの右上に表示されているご自身のアカウントアイコンをクリックし、「Microsoft アカウント」を選択してください。
2.  表示されたアカウント管理ページの左側にあるタブから「セキュリティ」を選択します。
3.  セキュリティのオプションが表示されますので、「サインイン方法の管理」をクリックしてください。
4.  2段階認証の項目を見つけ、「オンにする」をクリックします。
    * まだアカウントのパスワードを設定していない場合は、このタイミングでパスワードの設定を求められることがあります。画面の指示に従ってパスワードを設定してください。
5.  追加認証の方法を選択する画面が表示されます。セキュリティの観点から、認証アプリ（例：Microsoft Authenticator）のご利用をお勧めします。
    - 認証の手段が「アプリ」になっている状態で「今すぐ取得」ボタンをクリックします。
    - 携帯電話（スマートフォン）で認証アプリを準備します。Microsoft Authenticatorアプリ（鍵の中に人が描かれたようなアイコンが目印です）をダウンロードし、インストールしてください。
    - アプリの準備が整ったら、パソコンの画面で「次へ」をクリックします。
    - パソコンの画面にQRコードが表示されます。携帯電話にインストールしたMicrosoft Authenticatorアプリを起動し、画面の指示に従ってこのQRコードをスキャンしてください。（右下にQRコードアイコンがあるのでそれをタップします。）
    - QRコードの読み取りが成功し、アプリとの連携が完了すると、認証アプリによる2段階認証の基本的なセットアップは完了です。
すべての設定が完了したら、再度セキュリティの画面に戻り、2段階認証が「オン」になっていることをご確認ください。
    * **注記：** 設定直後に2段階認証が「オフ」と表示されている場合があります。その際は、一度ページを更新するか、再度2段階認証の管理画面に入り直して設定状況を確認してください。正しく設定が完了していれば、「2段階認証が承認されました」といった趣旨のメッセージが表示されるか、ステータスが「オン」に変わります。
以上で、2段階認証の設定は完了です。これにより、アカウントのセキュリティが向上します。

## カルステップへのAPI-keyの設定
解説動画： [https://youtu.be/zhi0mzJLS3o](https://youtu.be/zhi0mzJLS3o)

カルステップの文字起こし機能および要約機能を利用するためには、Microsoft Azure上で「音声サービス」と「Azure OpenAI Service」を設定し、それらのAPIキーとエンドポイント情報をカルステップに登録する必要があります。以下にその手順を説明します。

### 1. Azure リソースグループの作成
リソースグループは、Azureで利用する各種サービス（音声サービス、OpenAIサービスなど）をまとめて管理するためのグループです。

1.  Azureポータル（[https://portal.azure.com/](https://portal.azure.com/)）にサインインしてください。
2.  画面上部の検索バーに「リソースグループ」と入力し、表示された候補から「リソースグループ」サービスを選択します。
3.  「リソースグループ」の管理画面が表示されたら、左上にある「＋作成」ボタンをクリックします。
4.  以下の情報を入力または選択してください。
    * **サブスクリプション**: ご利用のAzureサブスクリプション（通常は「Azure subscription 1」などがデフォルトで選択されています）が選ばれていることを確認します。
    * **リソースグループ名**: 任意の名前を設定できます。管理しやすいように、例えば「KarustepResources」など、プロジェクトに関連する名前を推奨します。
    * **リージョン**: サービスを展開する地域を選択します。「(Asia Pacific) Japan East」（東日本）または「(Asia Pacific) Japan West」（西日本）のいずれかを選択してください。
        * **推奨：** こだわりがない場合や、Azure OpenAI Serviceで「Japan East」（東日本）しか選択できないため、「Japan East」に統一することをお勧めします。
5.  入力後、「レビューと作成」ボタンをクリックし、内容に誤りがないか確認の上、「作成」ボタンをクリックします。
6.  リソースグループの作成が完了すると通知が表示され、一覧に先ほど作成したリソースグループ名が表示されます。

### 2. Azure 音声サービス（Speech Service）の作成
カルステップの文字起こし機能に使用する音声サービスを作成します。

1.  Azureポータルの画面上部の検索バーに「音声サービス」と入力し、表示された候補から「音声サービス」を選択します。
2.  「音声サービス」の管理画面で、左上にある「＋作成」ボタンをクリックします。
3.  以下の情報を設定してください。
    - **サブスクリプション**: ご利用のAzureサブスクリプションを選択します。
    - **リソースグループ**: 先ほど作成したリソースグループ（例：「KarustepResources」）を選択します。
    - **リージョン**: 「Japan East」（東日本）を選択してください。
    - **名前**: 任意ですが、管理しやすい名前を設定します。例：「KarustepSpeechService」など
    - **価格レベル**: 「Standard S0」を選択することを推奨します。「Free F0」は無料枠がありますが、利用量に上限があるため、継続的なご利用には「Standard S0」が適しています。
    - **ネットワークやTagsなど**: デフォルト設定のままで問題ありません。
4.  「確認と作成」ボタンをクリックし、内容を確認後、「作成」ボタンをクリックしてデプロイを開始します。完了まで数分かかる場合があります。
5.  デプロイが完了したら、「リソースに移動」ボタンをクリックし、作成した音声サービスを開きます。
6.  開いた音声サービスの概要画面で「キーを管理するにはここをクリック」を選択します。
7.  表示されたキーのうち、「キー1 (KEY 1)」の右側にあるコピーアイコンをクリックしてキーをコピーします。このキーは後ほどカルステップアプリに設定しますので、大切に保管してください。

### 3. Azure OpenAI Service の作成
カルステップの要約機能に使用するAzure OpenAI Serviceを作成し、GPTモデルをデプロイします。

1.  Azureポータルの画面上部の検索バーに「Azure OpenAI」と入力し、表示された候補から「Azure OpenAI」サービスを選択します。
2.  「Azure OpenAI」の管理画面で、左上にある「＋作成」ボタンをクリックします。
3.  以下の情報を設定してください。
    - **サブスクリプション**: ご利用のAzureサブスクリプションを選択します。
    - **リソースグループ**: 先ほど作成したリソースグループ（例：「KarustepResources」）を選択します。
    - **リージョン**: 「Japan East」（東日本）を選択します。
    - **名前**: 任意ですが、管理しやすい名前を設定します。例：「KarustepOpenAI」。
        * **重要：** この名前はAzure OpenAIサービスのエンドポイントURLの一部として使用されます。他のユーザーが登録済で「指定した名前は既に使用されています」といったエラーが表示された場合は、クリニック名の一部や任意の文字列を追加するなどして、ユニークな名前に変更してください。
    - **価格レベル**: 「Standard S0」を選択します。
    - **ネットワークやTags**: デフォルト設定のままで問題ありません。
4. 内容を確認後、「作成」ボタンをクリックしてデプロイを開始します。完了まで数分かかる場合があります。
5.  デプロイが完了したら、「リソースに移動」ボタンをクリックして、作成したAzure OpenAIサービスを開きます。
6.  開いたAzure OpenAIサービスの概要ページで、「Go to Azure AI Foundary portal」というリンクをクリックして、Azure AI Foundaryを開きます。
7.  Azure AI Foundaryの左側メニューから「チャット」を選択し、「＋新しいデプロイを作成」をクリックします。
    - **基本モデルを選択**: 利用するモデル「gpt-4o」を選択します。
    - **デプロイ名**: 「gpt-4o」にしてください。
    - **デプロイの種類**: 「グローバル標準」もしくは「Standard」などを選択します。
    - 設定後、「デプロイ」ボタンをクリックします。モデルのデプロイが完了するまで待ちます。
8.  デプロイが完了したら、Azureポータルの作成したAzure OpenAIサービスのページに戻ります。
9.  左側メニューが「概要」の状態で、「キーを管理するにはここをクリック」を選択します。
10. 表示されたキーのうち、「キー1 (KEY 1)」の右側にあるコピーアイコンをクリックしてキーをコピーします。
11. 同じ画面に表示されている「エンドポイント」のURLも右側にあるコピーアイコンをクリックしてコピーします。

これら2つの情報は後ほどカルステップアプリに設定しますので、大切に保管してください。

### 4. カルステップアプリへのAPIキーとエンドポイントの設定
上記で取得したAPIキーとエンドポイントをカルステップアプリに設定します。
1.  カルステップアプリ（カルステップ.bat）を起動します。
    * ライセンス認証が正常に完了していれば、「ライセンス認証に成功しました」といったメッセージが表示されます。
2.  アプリの画面上部にある「設定」タブをクリックし、「API-keyの登録」を選択してください。
3.  APIキー登録画面が表示されたら、以下の情報をそれぞれ対応するテキストボックスに入力または貼り付けしてください。
    - **Speech Key**: 「2. Azure 音声サービス（Speech Service）の作成」の手順7でコピーした音声サービスの「キー1」を貼り付けます。
    - **OpenAI API Key**: 「3. Azure OpenAI Service の作成」の手順10でコピーしたAzure OpenAIサービスの「キー1」を貼り付けます。
    - **OpenAI Endpoint**: 「3. Azure OpenAI Service の作成」の手順11でコピーしたAzure OpenAIサービスの「エンドポイントURL」を貼り付けます。
4.  すべての情報を正しく入力したら、「保存」ボタンをクリックします。
以上で、カルステップアプリでAzureのAIサービスを利用するためのAPIキーおよびエンドポイントの設定は完了です。お疲れ様でした。

# カルステップの使用方法
カルステップ実演動画（short version）： [https://youtu.be/XBsISBwFxck](https://youtu.be/XBsISBwFxck)

カルステップ実演動画（詳細説明）： [https://youtu.be/axApARZNZN0](https://youtu.be/axApARZNZN0)

カルステップの基本的な使用方法についてご説明します。
### 1. カルステップの起動
1.  カルステップが保存されているフォルダを開き、「カルステップ.bat」をダブルクリックしてアプリケーションを起動します。
2.  ライセンス認証が正常に完了していれば、カルステップのメイン操作画面が表示されます。

### 2. 基本的な録音操作（画面上のボタンを使用）
カルステップのメイン画面には、録音をコントロールするための主要なボタンが配置されています。
1.  **録音開始**: 診療の記録を開始する際は、「スタート」ボタンをクリックしてください。
2.  **録音終了**: 記録を終了する場合は、「ストップ」ボタンをクリックします。この操作により、録音された音声の文字起こし、AIによる要約、およびデータの保存が自動的に実行されます。
3.  **一時停止**: 録音を一時的に中断したい場合は、「一時停止」ボタンをクリックします。例えば、患者さんが一時的に席を外す場合などに使用します。
4.  **録音再開**: 一時停止した録音を同じ記録として再開する場合は、「リスタート」ボタンをクリックしてください。

録音中はタスクバーのアイコンが下図のように、赤いアイコンに変化し点滅するため、一目で状態が分かります。
![録音状態のタスクバー](images/2025-05-22_171158.png)

### 3. フットスイッチを使用した録音操作
お渡ししているフットスイッチを使用することで、より迅速かつハンズフリーで録音操作が可能です。この機能は、カルステップの画面が最前面に表示されていない状態（例：電子カルテを操作中など）でも利用できます。
1.  **録音開始**: フットスイッチを一度踏むと、録音が開始されます。
2.  **録音終了**: 録音中に再度フットスイッチを踏むと、録音が終了します。その後、自動的に文字起こし、要約処理、データ保存が行われます。

もしゲーミングマウスの副ボタンやStream Deckを用いて、カルステップをご利用される場合は「Ctrl + Shift + ,(カンマ)」を割り当ててください。

### 4. 記録内容の確認方法
要約内容は、いつでも簡単に確認することができます。
1.  カルステップのメイン画面にある「要約を見る」ボタンをクリックしてください。
2.  過去の記録データの一覧が表示され、任意の記録を閲覧できます。

音声ファイルや全文文字起こしの文章は「tempフォルダ（"C:\temp"）」に保存されます。ファイル名は録音時のタイムスタンプ（日付と時刻）となっています。
![録音ファイルの保存場所](images/2025-05-19_002750.png)

### 5. 出力形式とシステムプロンプトについて
カルステップは、AIへの指示（システムプロンプト）を調整することで、出力される情報の形式や詳細度をコントロールする機能を有しています。
* **診療科や状況に応じた設定例**:
    * **デフォルト**: 例えば、保護者とお子様が一緒に診察を受ける場合など、複数の話者が存在する状況にも対応しやすく、汎用的な内容で出力されるように調整されています。
    * **内科（1対1）**: 医師と患者様の1対1の対話を主眼とし、AIが話者を誤認識しにくいように最適化されたプロンプトが設定されています。
    * **会話ログ形式**: 参加者の発言が時系列に沿って記録される形式です。

これらのシステムプロンプトは、「診療科選択」のタブから切り替えることが可能です。詳細な編集方法については、「カルステップのシステムプロンプトと補正辞書の編集方法」の項目をご参照ください。

# カルステップのシステムプロンプトと補正辞書の編集方法
解説動画： [https://youtu.be/9_5bIymDD3Q](https://youtu.be/9_5bIymDD3Q)

カルステップでは、AIによる文字起こしや要約の精度、さらには出力される情報の形式を、診療科や状況に合わせてより最適化するために、システムプロンプトと補正辞書を編集する機能を提供しています。

### 1. システムプロンプトの選択と編集
システムプロンプトは、AIに対してどのような役割を期待し、どのような情報に基づいて、どのような形式でアウトプットを生成してほしいかを指示するための設定群です。

#### a. システムプロンプトの選択
1.  カルステップアプリの画面右上にある「診療科選択」タブをクリックしてください。
2.  あらかじめ登録されているシステムプロンプトの一覧（例：「デフォルト（同時複数患者可）」「内科（１対１）」「会話ログあり」など）が表示されます。利用するシーンや目的に最も適したものを選択してください。

また、システムプロンプトは追加可能です。カルステップのフォルダの中にある「programs」フォルダに入ると、システムプロンプトがあります。このうちのどれかを複製すれば、システムプロンプトを増やせます。ファイル名は必ず「2桁の数字＋名前」にしてください。例えば「02.耳鼻科オリジナル.txt」といった形でファイル名を設定してください。
![システムプロンプトの保存場所](images/2025-05-22_120448.png)

#### b. システムプロンプトの編集
現在選択しているシステムプロンプトの内容をカスタマイズしたり、必要に応じて新たなシステムプロンプトを作成したりすることが可能です。

1.  アプリ画面上部の「設定」タブよりシステムプロンプトの編集画面を開きます。
2.  編集画面では、主に以下のような項目について、AIへの指示を具体的に記述・編集することができます。
    * **入力フォーマット**: AIにどのような内容を覚えておいてほしいか指定できます。
    * **出力項目と内容の指示**: Googleスプレッドシートの各セル（「fact」「assessment」「ToDo」）に、どのような情報を、どのような形式や粒度で記述してほしいかを詳細に指示します。
        * **具体例**: 「会話ログあり」のプロンプトの場合、「To-Doセクション」に「発話された内容を可能な限り忠実に転記すること」といった指示を含めることで、会話の逐語記録に近い出力を得ることができます。
3.  編集が完了したら、必ず「保存」ボタンをクリックして、変更内容をシステムプロンプトに適用してください。

### 2. 補正辞書の編集
補正辞書に特定の単語やフレーズを登録しておくことで、専門用語、略語、固有名称（医薬品名、施設名、地域名など）、あるいは特有の言い回しについて、AIがより正確に認識し、意図した通りの正しい表記で出力するよう促すことができます。

1.  カルステップアプリ内の「設定」タブから「補正辞書の編集」画面を開いてください。
2.  以下の形式に従って、AIに正しく認識・変換させたい言葉と、それに対応する正しい表記を一行ずつ登録します。
    * **登録形式**: `AIに認識させたい言葉（ひらがなでの入力推奨、またはAIが誤認識しやすい実際の入力例）` → `AIに出力させたい正しい表記（漢字、カタカナ、正式名称など）`
    * **登録例**:
        * `じびいんこうか` → `耳鼻咽喉科`
        * `かるなーる` → `カロナール`
        * `あいしーゆー` → `ICU（集中治療室）`
        * `ぷろびーえぬぴー` → `proBNP（心不全参考値）`
3.  必要な単語の登録や編集が完了したら、「保存」ボタンをクリックしてください。